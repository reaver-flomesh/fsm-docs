---
title: 「アプリケーションコンテナ起動」
description: 「アプリケーションコンテナ起動」
type: docs
---

# コンテナの起動

FSM はサイドカー プロキシを使用してサービス メッシュの一部であるアプリケーション ポッドを挿入し、サイドカー プロキシを介してポッドとの間ですべてのトラフィックをルーティングするようにトラフィック リダイレクト ルールをセットアップするため、状況によっては、既存のアプリケーション コンテナーが期待どおりに起動しない場合があります。

## アプリケーション コンテナが起動時にネットワーク接続に依存している場合

起動時にネットワーク接続に依存するアプリケーション コンテナは、Pipy サイドカー プロキシ コンテナと「fsm-init」init コンテナが FSM によってアプリケーション ポッドに挿入されると、問題が発生する可能性があります。これは、サイドカー インジェクション時に、アプリケーション コンテナーからのすべての TCP ベースのネットワーク トラフィックがサイドカー プロキシにルーティングされ、サービス メッシュ トラフィック ポリシーの対象となるためです。これは、サイドカー プロキシ コンテナーが挿入されていない場合と同様にアプリケーション トラフィックをルーティングするには、まず FSM コントローラーがアプリケーション ポッドでサイドカー プロキシをプログラムして、そのようなトラフィックを許可する必要があることを意味します。 Pipy サイドカー プロキシが構成されていないと、アプリケーション コンテナーからのすべてのトラフィックがドロップされます。

FSM が許容トラフィック ポリシー モードを有効にして構成されている場合、FSM は Pipy サイドカー プロキシでワイルドカード トラフィック ポリシー ルールをプログラムし、すべてのポッドがメッシュの一部であるすべてのサービスにアクセスできるようにします。 FSM が SMI トラフィック ポリシー モードを有効にして構成されている場合、明示的な SMI ポリシーを構成して、メッシュ内のアプリケーション間の通信を有効にする必要があります。

トラフィック ポリシー モードに関係なく、起動時にネットワーク接続に依存するアプリケーション コンテナーは、ネットワークの準備が整うまでの遅延に回復力がない場合、起動時に問題が発生する可能性があります。 Pipy プロキシ サイドカーが挿入されると、アプリケーション トラフィックがネットワークを通過できるようにサイドカー プロキシが FSM コントローラーによってプログラムされた場合にのみ、ネットワークは準備完了と見なされます。

アプリケーション コンテナーは、アプリケーション ポッド内の Pipy プロキシ サイドカーの初期ブートストラップ フェーズに対して十分な回復力を備えていることをお勧めします。

[container's restart policy](https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#restart-policy) もアプリケーション コンテナの起動に影響することに注意することが重要です。アプリケーション コンテナの起動ポリシーが「なし」に設定されていて、起動時にネットワーク接続の準備が整っているかどうかに依存している場合、Pipy プロキシ サイドカーがアプリケーション コンテナのその結果、アプリケーション コンテナーが終了し、起動の失敗から回復できなくなります。このため、アプリケーション コンテナが起動時にネットワーク接続に依存している場合は、「Never」のコンテナ再起動ポリシーを使用しないことをお勧めします。

### 関連する問題 (進行中の作業)

- [FSM issue 2316](https://github.com/openservicemesh/fsm/issues/2316): Pipy プロキシ サイドカーの準備が整うまで、アプリケーション コンテナーの起動を延期する
- [Kubernetes issue 65502](https://github.com/kubernetes/kubernetes/issues/65502): 同じポッド上のコンテナー間の起動の依存関係をサポートする

